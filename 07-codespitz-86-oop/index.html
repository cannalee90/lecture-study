<!doctype html>
<html>
  <head>
  </head>
  <body>
    <section id="target" data-viewmodel="wrapper">
      <h2 data-viewmodel="title"></h2>
      <section data-viewmodel="contents"></section>
    </section>
  </body>
  <script>

    const type = (value, type) => {
      if (typeof type === 'string') {
        if (typeof value !== type) {
          throw `${value} is not ${type}`;
        }
      } else if (!(value instanceof type)) {
        throw `${value} is not ${type}`;
      }
      return value;
    }



    const ViewModel = class {
      static #private = Symbol();
      static get(data) {
        return new ViewModel(this.#private, data);
      }

      styles = {};
      attributes = {};
      properties = {};
      events = {};
      constructor(checker, data) {
        if (checker !== ViewModel.#private) {
          throw 'use viewModel.get()!';
        }
        Object.entries(data).forEach(([key, value]) => {
          switch(k) {
            case 'style':
              this.style = value;
              break;
            case 'attributes':
              this.attributes = value;
              break;
            case 'properties':
              this.properties = value;
              break;
            case 'events':
              this.events = value;
              break;
            default:
              this[k] = v;
          }
        });
        Object.seal(this);
      }
    }

    const BinderItem = class {
      el;
      viewmodel;
      constructor(el, viewmodel, _ = type(el, HTMLElement), __ = type(viewmodel, 'string')) {
        this.el = el;
        this.viewmodel = viewmodel;
        Object.freeze(this);
      }
    }

    const Binder = class {
      #items = new Set;

      add(v, _=type(v, BinderItem)) {
        this.#items.add(v);
      }

      render(viewmodel, _=type(viewmodel, ViewModel)) {
        this.#items.forEach(item => {
          const vm = type(viewmodel[item.viewmodel], ViewModel);
          const el = item.el;
          Object.entries(vm.styles).forEach(([key, value]) => {
            el.style[k] = v
          });
          Object.entries(vm.attribtues).forEach(([key, value]) => {
            el.setAttribute[k] = v
          });
          Object.entries(vm.properties).forEach(([key, value]) => {
            el.style[key] = value;
          });
          Object.entries(vm.events).forEach(([key, value]) => {
            el["on" + key] = e => value.call(el, e, viewmodel)
          });
        });
      }
    }


  </script>
</html>

